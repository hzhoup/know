### 项目初始化

```bash
pnpm create vite
- vue
- ts
pnpm install
```

删除无用代码，保留最基本配置

### 配置别名

`vite.config.ts`

```ts
import { defineConfig } from 'vite'  
import vue from '@vitejs/plugin-vue'   
import { resolve } from 'path' 
  
const root = process.cwd()  

const resolvePath = (...paths: string[]) => resolve(__dirname, ...paths)
  
// https://vitejs.dev/config/  
export default defineConfig({  
  root,  
  plugins: [vue()],  
  resolve: {  
    alias: {  
      '/@': resolvePath('src'),  
      '/#': resolvePath('build')  
    }  
  }  
})
```

`tsconfig.json`

```json
{
	"compilerOptions": {
		"baseUrl": ".",
		"paths": {  
		  "/@/*": ["src/*"],  
		  "/#/*": ["build/*"]  
		}
	}
}
```

### 环境变量配置

将 `vite-env.d.ts` 移入 `/src/types` 下：

```ts
export interface ImportMetaEnv {  
    // 项目公共基础路径  
    readonly VITE_BASE: string  
    // 开发服务器端口  
    readonly VITE_PORT: number  
    // 开发代理  
    readonly VITE_PROXY: [string, string][]  
}  
  
interface ImportMeta {  
    readonly env: ImportMetaEnv  
}
```

创建 `/build/utils/helpers.ts`

```ts
import { ImportMetaEnv} from '@/types/vite-env'  
  
export function wrapperEnv(envConf: Record<string, any>) {  
    const result: any = {}  
  
    for (const key of Object.keys(envConf)) {  
        let value = envConf[key].replace(/\\n/g, '\n')  
  
        value = value === 'true' ? true : value === 'false' ? false : value  
  
        if (key === 'VITE_PORT') value = Number(value)  
  
        if (key === 'VITE_PROXY' && value) {  
            try {  
                value = JSON.parse(value.replace(/'/g, '"'))  
            } catch {  
                value = ''  
            }  
        }  
  
        result[key] = value  
    }  
  
    return result as ImportMetaEnv  
}
```

创建 `/build/utils/proxy.ts`

```ts
import type { ProxyOptions } from 'vite'  
  
type ProxyItem = [string, string]  
type ProxyArr = ProxyItem[]  
  
type ProxyTarget = Record<string, ProxyOptions>  
  
export function createProxy(list: ProxyArr = []) {  
    const result: ProxyTarget = {}  
    for (const [prefix, target] of list) {  
        result[prefix] = {  
            target,  
            changeOrigin: true,  
            ws: true,  
            rewrite: (path) => path.replace(new RegExp(`^${prefix}`), '')  
        }  
    }  
    return result  
}
```

`vite.config.ts`

```ts
import { defineConfig, loadEnv } from 'vite'  
import vue from '@vitejs/plugin-vue'  
import { resolve } from 'path'  
import { wrapperEnv } from '#/utils/helpers'  
import { createProxy } from '#/utils/proxy'
  
const root = process.cwd()  
  
const resolvePath = (...paths: string[]) => resolve(__dirname, ...paths)  
  
// https://vitejs.dev/config/  
export default defineConfig(({ command, mode }) => {  
  const isBuild = command === 'build'  
  
  const env = loadEnv(mode, root, ['VITE_', 'APP_'])  
  const viteEnv = wrapperEnv(env)  
  
  return {  
    root,  
    base: viteEnv.VITE_BASE,    
	envPrefix: ['VITE_', 'APP_'],
    plugins: [vue()],  
    resolve: {  
      alias: {  
        '/@': resolvePath('src'),  
        '/#': resolvePath('build')  
      }  
    },  
    server: {  
      host: true,  
      port: viteEnv.VITE_PORT,  
      cors: true,  
      proxy: createProxy(viteEnv.VITE_PROXY)  
    },  
    esbuild: {  
      pure: isBuild ? ['console.log', 'debugger'] : []  
    },  
    build: {  
      target: 'es2015',  
      cssTarget: 'chrome80',  
      chunkSizeWarningLimit: 2048  
    }  
  }  
})
```

### vite 插件封装

创建 `/build/plugins/index.ts`

```ts
import { ImportMetaEnv } from '/@/types/vite-env'  
import { PluginOption } from 'vite'  
import vue from '@vitejs/plugin-vue'  
  
export const setupVitePlugin = (env: ImportMetaEnv, isBuild: boolean): PluginOption[] => {  
    const plugins: PluginOption[] = []  
      
    plugins.push(vue())  
      
    return plugins  
}
```

在 `vite.config.ts` 中调用 `setupVitePlugin(viteEnv, isBuild)`

### prettier 配置

```bash
pnpm add prettier -D
```

`.prettierrc`

```json
{  
  "useTabs": false,  
  "tabWidth": 2,  
  "printWidth": 120,  
  "singleQuote": true,  
  "trailingComma": "none",  
  "bracketSpacing": true,  
  "semi": false  
}
```

### eslint

```bash
pnpm add eslint @typescript-eslint/eslint-plugin @typescript-eslint/parser eslint-plugin-vue -D
```

`.eslintrc.yml`

```yaml
root: true  
env:  
  browser: true  
  es2021: true  
  node: true  
globals:  
  defineOptions: readonly  
extends:  
  - eslint:recommended  
  - plugin:vue/vue3-recommended  
  - plugin:@typescript-eslint/recommended  
overrides: [ ]  
parser: 'vue-eslint-parser'  
parserOptions:  
  ecmaVersion: latest  
  sourceType: module  
  parser: '@typescript-eslint/parser'  
  jsxPragma: React,  
  ecmaFeatures:  
    jsx: true  
plugins:  
  - vue  
  - '@typescript-eslint'  
rules: {}
```

### 解决 eslint & prettier

```bash
pnpm add eslint-config-prettier eslint-plugin-prettier -D
```

```yaml
extends:  
  - eslint:recommended  
  - plugin:vue/vue3-recommended  
  - plugin:@typescript-eslint/recommended  
  - plugin:prettier/recommended
```

### stylelint

```bash
pnpm add sass stylelint stylelint-config-prettier stylelint-config-recommended-scss stylelint-config-standard stylelint-config-standard-vue stylelint-order stylelint-scss postcss postcss-html postcss-scss -D
```

`.stylelintrc`

```json
{  
  "extends": [  
    "stylelint-config-standard",  
    "stylelint-config-prettier",  
    "stylelint-config-recommended-scss",  
    "stylelint-config-standard-vue"  
  ],  
  "plugins": [  
    "stylelint-order"  
  ],  
  "overrides": [  
    {  
      "files": [  
        "**/*.(css|scss|vue|html)"  
      ],  
      "customSyntax": "postcss-scss"  
    },  
    {  
      "files": [  
        "**/*.(vue|html)"  
      ],  
      "customSyntax": "postcss-html"  
    }  
  ],  
  "ignoreFiles": [  
    "**/*.js",  
    "**/*.ts",  
    "**/*.jsx",  
    "**/*.tsx",  
    "**/*.json",  
    "**/*.md",  
    "**/*.yml",  
    "**/*.yaml"  
  ],  
  "rules": {  
    "indentation": 2,  
    "import-notation": "string",  
    "scss/at-import-partial-extension": "always",  
    "selector-pseudo-element-no-unknown": [  
      true,  
      {  
        "ignorePseudoElements": [  
          "v-deep",  
          ":deep"  
        ]  
      }  
    ],  
    "number-leading-zero": "always",  
    "no-descending-specificity": null,  
    "function-url-quotes": "always",  
    "string-quotes": "single",  
    "unit-case": null,  
    "color-hex-case": "lower",  
    "color-hex-length": "long",  
    "rule-empty-line-before": [  
      "always-multi-line",  
      {  
        "except": [  
          "first-nested"  
        ],  
        "ignore": [  
          "after-comment"  
        ]  
      }  
    ],  
    "font-family-no-missing-generic-family-keyword": null,  
    "selector-type-no-unknown": null,  
    "block-opening-brace-space-before": "always",  
    "at-rule-no-unknown": null,  
    "no-duplicate-selectors": null,  
    "property-no-unknown": null,  
    "no-empty-source": null,  
    "selector-class-pattern": null,  
    "keyframes-name-pattern": null,  
    "selector-pseudo-class-no-unknown": [  
      true,  
      {  
        "ignorePseudoClasses": [  
          "global",  
          "deep"  
        ]  
      }  
    ],  
    "function-no-unknown": null,  
    "order/properties-order": [  
      "position",  
      "top",  
      "right",  
      "bottom",  
      "left",  
      "z-index",  
      "display",  
      "justify-content",  
      "align-items",  
      "float",  
      "clear",  
      "overflow",  
      "overflow-x",  
      "overflow-y",  
      "margin",  
      "margin-top",  
      "margin-right",  
      "margin-bottom",  
      "margin-left",  
      "padding",  
      "padding-top",  
      "padding-right",  
      "padding-bottom",  
      "padding-left",  
      "width",  
      "min-width",  
      "max-width",  
      "height",  
      "min-height",  
      "max-height",  
      "font-size",  
      "font-family",  
      "font-weight",  
      "border",  
      "border-style",  
      "border-width",  
      "border-color",  
      "border-top",  
      "border-top-style",  
      "border-top-width",  
      "border-top-color",  
      "border-right",  
      "border-right-style",  
      "border-right-width",  
      "border-right-color",  
      "border-bottom",  
      "border-bottom-style",  
      "border-bottom-width",  
      "border-bottom-color",  
      "border-left",  
      "border-left-style",  
      "border-left-width",  
      "border-left-color",  
      "border-radius",  
      "text-align",  
      "text-justify",  
      "text-indent",  
      "text-overflow",  
      "text-decoration",  
      "white-space",  
      "color",  
      "background",  
      "background-position",  
      "background-repeat",  
      "background-size",  
      "background-color",  
      "background-clip",  
      "opacity",  
      "filter",  
      "list-style",  
      "outline",  
      "visibility",  
      "box-shadow",  
      "text-shadow",  
      "resize",  
      "transition"  
    ]  
  }  
}
```

### 集成 husky 和 lint-staged

```bash
pnpx husky-init
pnpm install
pnpm add lint-staged -D
```

`package.json`

```json
"lint-staged": {  
  "*.{js,jsx,ts,tsx,vue,json,md}": "prettier --write",  
  "*.{js,jsx,ts,tsx,vue}": "eslint --fix",
  "*.{html,vue,css,scss}": "stylelint --fix"  
}
```

### 提交规范

```bash
pnpm add commitizen cz-conventional-changelog @commitlint/config-conventional @commitlint/cli -D
```

```json
// package.json
"config": {  
  "commitizen": {  
    "path": "./node_modules/cz-conventional-changelog"  
  }  
}
```

```bash
echo "module.exports = {extends: ['@commitlint/config-conventional']}" > commitlint.config.cjs
npx husky add .husky/commit-msg "npx --no-install commitlint --edit $1"
```

### 单元测试约束

```bash
pnpm add @vue/test-utils vitest jsdom -D
```

`vite.config.ts`

```ts
/// <reference types="vitest" />

/** */

test: {  
  globals: true,  
  environment: 'jsdom',  
  transformMode: {  
    web: [/.[tj]sx$/]  
  }  
}
```

`package.json`

```json
"scripts": {
	"test": "vitest",  
	"test:run": "vitest run",  
	"test:ui": "vitest --ui",
}
```

```bash
npx husky add .husky/pre-push "npm run test:run $1"
```